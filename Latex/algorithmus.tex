\chapter{Aufbau des Verfahrens}

Um nun aufbauend auf diesen Erkenntnissen die allgemeinen Flugbahnen beliebiger Ladungstr\"ager durch beliebige, unter Umst\"anden
auch \textit{inhomogene}, Magnetfelder simulieren zu k\"onnen, sind mehrere Zwischenschritte notwendig.
Unter Verwendung der Ergebnisse aus \fref{sec:flugbahnbeschreibung} wird zun\"achst ein Verfahren hergeleitet, welches es erm\"oglicht,
die Teilchenflugbahnen in \textit{homogenen} Magnetfeldern zu simulieren. Dieses Verfahren kann anschlie{\ss}end auf beliebige
Magnetfelder ausgeweitet werden, indem man diese abschnittsweise durch homogene Teilfelder approximiert, auf welchen dann das
hergeleitete Verfahren zur Anwendung kommt.

\section{Simulation der Flugbahn im homogenen Magnetfeld}

Bewegen sich Teilchen im Raum, so kann dies in allen m\"oglichen Orientierungen erfolgen. Um diesem Sachverhalt Rechnung zu tragen,
werden zun\"achst s\"amtliche Schritte im lokalen Bezugssystem des Ladungstr\"agers durchgef\"uhrt. Unabh\"angig von der speziellen
Orientierung des Teilchens gew\"ahrleistet dies einheitliche Rechenvorschriften, welche im Anschluss durch einfache
Basistransformationen in das globale Koordinatensystem \"uberf\"uhrt werden k\"onnen. Die gr\"o{\ss}en \(v\) und \(B\), welche
in \fref{sec:flugbahnbeschreibung} noch als Skalare betrachtet wurden, m\"ussen nun \textit{vektoriell} als \(\vec{v}\) und \(\vec{B}\)
aufgefasst werden. Es wird sich aber zeigen, dass dies durch geeignete Wahl der lokalen Basisvektoren nur eine untergeordnete Rolle
spielt.

\subsection{Die Flugbahn im lokalen Bezugssystem des Ladungstr\"agers}
\label{sec:lokales_bezugssystem}

Das lokale Koordinatensystem wird nun so gew\"ahlt, dass sich die Position des Teilchens genau im Ursprung befindet.
Weiterhin zeigen die magnetischen
Feldlinien genau in Richtung der \textit{z-Achse}, die orthogonale Projektion der Teilchenbewegung auf die xy-Ebene zeigt genau
entlang der \textit{y-Achse}. Auf diese Weise lassen sich die beiden Anteile der Bewegung, welche in \fref{sec:flugbahnbeschreibung}
beschrieben wurden, optimal trennen: Der gleichf\"ormige Anteil der Bewegung, welcher auf \(v_\parallel\) zur\"uckzuf\"uhren ist,
verl\"auft genau entlang der \textit{z-Achse}, w\"ahrend \(v_\perp\) eine Kreisbewegung in der \textit{xy-Ebene} verursacht.
\(v_\parallel\) beeinflusst also nur die \textit{z-Koordinate} des Ladungstr\"agers, w\"ahrend \(v_\perp\) ausschlie{\ss}lich die
\textit{x}-, sowie die \textit{y-Koordinate} beeinflusst.

Um nun den Mittelpunkt \(M\) des Kreises zu ermitteln, welchem die Bewegung in der \textit{xy-Ebene} folgt, kann zun\"achst der
Radius \(r\) dieses Kreises bestimmt werden. Gem\"a{\ss} der Konstruktion und unter Ber\"ucksichtigung der \textit{Linke-Hand-Regel}
liegt \(M\) dann genau auf der \textit{x-Achse} und hat die xy-Koordinaten \(\left(-r| 0 \right)\). Der Radius l\"asst sich nun,
wie in \fref{sec:flugbahnbeschreibung} mit \fref{eq:radius} beschrieben, ohne weiteres berechnen. Man beachte, dass aufgrund der
Konstruktion nur die \textit{z-Koordinate} des Magnetfeldes \(\vec{B}\), sowie die \textit{y-Koordinate} der Teilchengeschwindigkeit
\(\vec{v}\) relevant ist. Weiterhin ist ebenfalls konstruktionsbedingt \(\alpha = \frac{\pi}{2}\), weshalb der Term \(\sin{\alpha}\)
entf\"allt. Benutzen wir also \(v_\perp = \vec{v}_y\) und \(B = \vec{B}_z\), so erhalten wir folgenden Zusammenhang f\"ur den Radius
\(r\) im lokalen Bezugssystem:
\begin{equation}
  r = \frac{m \cdot \vec{v}_y}{Q \cdot \vec{B}_z}
\end{equation}
Damit der exakte Punkt berechnet werden kann, an dem sich der Ladungstr\"ager nach einer gewissen Zeitspanne \(t\) befindet, wird
weiterhin die Winkelgeschwindigkeit \(\omega\) der Kreisbewegung ben\"otigt. Wenden wir die \"Uberlegung \(B = \vec{B}_z \) auf
\fref{eq:omega} an, so ergibt sich f\"ur die Winkelgeschwindigkeit:
\begin{equation}
  \omega = \frac{Q \cdot \vec{B}_z}{m}
\end{equation}
Aus der Winkelgeschwindigkeit \(\omega\), dem Radius \(r\) und der gegebenen Simulationszeit \(t\) l\"asst sich mithilfe der
Bewegungsgleichungen der gleichf\"ormigen Kreisbewegung die exakte Position des Teilchens in der xy-Ebene ermitteln.
Hierzu wird der folgende allgemeine Zusammenhang angewandt, der f\"ur gleichf\"ormige Kreisbewegungen in der Ebene g\"ultig ist:
\begin{equation*}
  \begin{pmatrix}
    x(t) \\
    y(t)
  \end{pmatrix}
  =
  \begin{pmatrix}
    r \cdot \sin{\left(\omega \cdot t\right)} + M_x \\
    r \cdot \cos{\left(\omega \cdot t\right)} + M_y
  \end{pmatrix}
\end{equation*}
Die Koordinaten von \(M_x\) und \(M_y\) erh\"alt man direkt aus den obigen \"Uberlegungen.

Die Ver\"anderung der z-Koordinate, also der Anteil der Bewegung, welcher durch \(\vec{v_\parallel}\) verursacht wird, l\"asst sich
direkt mithilfe \fref{eq:s_parallel} bestimmen. Auch hier l\"asst sich aufgrund der Konstruktion die Vereinfachung
\(v_\parallel = \vec{v}_z\) durchf\"uhren, da \(v_\parallel\) lediglich durch die Projektion von \(\vec{v}\) auf die z-Achse gegeben ist.
Insgesamt erhalten wir folgenden Zusammenhang \"uber die neue Position des
Ladungstr\"agers nach der Zeit \(t\), bezogen auf sein lokales Koordinatensystem:
\begin{equation}
  \begin{pmatrix}
    x(t) \\
    y(t) \\
    z(t)
  \end{pmatrix}
  =
  \begin{pmatrix}
    r \cdot \sin{\left(\omega \cdot t\right)} - r \\
    r \cdot \cos{\left(\omega \cdot t\right)} \\
    \vec{v}_z \cdot t
  \end{pmatrix}
\end{equation}

\subsection{\"Ubertragung auf das globale Koordinatensystem}

Um die neue Position des Ladungstr\"agers bezogen auf das globale Koordinatensystem zu erhalten, ist ein Wechsel der Basis erforderlich.
Zun\"achst m\"ussen die Gr\"o{\ss}en \(\vec{v}\) und \(\vec{B}\) in das lokale Bezugssystem des Ladungstr\"agers \"uberf\"uhrt werden,
damit in dieser neuen Basis die Zusammenh\"ange aus \fref{sec:lokales_bezugssystem} angewandt werden k\"onnen. Anschlie{\ss}end werden
die Ergebnisse, also die berechnete neue Position des Ladungstr\"agers, wieder zur\"uck in die urspr\"ungliche Basis transformiert.

\subsubsection{Eulersche Winkel}

Betrachtet man das vorliegende Modell genauer, so f\"allt auf, dass sich alle notwendigen Transformationen auf die
Hintereinanderausf\"uhrung von Drehungen zur\"uckf\"uhren lassen. Da es sich bei Drehungen um sogenannte orthogonale Transformationen
handelt, bleiben Abst\"ande und Normen nach der Transformation erhalten. Diese Eigenschaft ist besonders wichtig, da sich sonst
die Erkenntnisse aus \fref{sec:lokales_bezugssystem} nicht ohne weiteres auf die transformierten Gr\"o{\ss}en anwenden lie{\ss}en.

Die Hintereinanderausf\"uhrung von Drehungen wird durch sogenannte \textit{Eulersche Winkel} beschrieben. Hierbei handelt es sich
um die Angabe von Winkeln, die jeweils die Rotation um eine Achse beschreiben. Die Besonderheit hierbei ist, dass nur die erste
Rotation um eine \textit{raumfeste} Achse erfolgt. Die weiteren Drehungen beziehen sich stets auf die mitgedrehten lokalen Achsen des
zu drehenden K\"orpers.

Seien \(R_x(\alpha)\), \(R_y(\beta)\), \(R_z(\gamma)\) die Drehmatrizen zur Drehung um die \textit{globalen} Achsen \(x\), \(y\)
und \(z\). Nach \cite{Fis12}\footnote{Vgl. hierzu Abschnitt 5.3.6 f\"ur einen ausf\"uhrlichen Beweis.} ergibt sich die
Gesamtdrehmatrix einer eulerschen Drehung durch das Produkt der einzelnen Drehmatrizen
in der gew\"unschten Reihenfolge. M\"ochte man beispielweise zun\"achst um die \textit{globale} \(x\)-Achse, dann um die mitgedrehte
\textit{lokale} \(y\)-Achse und anschlie{\ss}end um die resultierende \textit{lokale} \(z\)-Achse drehen, ergibt sich die
Gesamtdrehmatrix \(R\) zu \(R = R_x(\alpha) \cdot R_y(\beta) \cdot R_z(\gamma)\), wenn jeweils um die zugeh\"origen Winkel
\(\alpha\), \(\beta\) und \(\gamma\) gedreht wird, die man in diesem Kontext als \textit{Eulersche Winkel} bezeichnet.

M\"ochte man die Drehung r\"uckg\"angig machen, so stellt sich die Frage nach der \textit{inversen} zu \(R\), also \(R^{-1}\).
Da f\"ur die Matrizen der Einzeldrehungen jeweils der Zusammenhang \(R_g(\alpha)^{-1} = R_g(-\alpha)\) gilt, wobei \(g\) eine beliebige
Achse beschreibt, gilt f\"ur die Inverse der Gesamtdrehmatrix \(R\):
\begin{equation}
  \label{eq:gesamtdrehung}
  \begin{split}
R^{-1} = \left(R_x(\alpha) \cdot R_y(\beta) \cdot R_z(\gamma)\right)^{-1} = R_z(\gamma)^{-1} \cdot R_y(\beta)^{-1} \cdot
R_x(\alpha)^{-1} \\
= R_z(-\gamma) \cdot R_y(-\beta) \cdot R_x(-\alpha)
  \end{split}
\end{equation}

\subsubsection{Bestimmung der Drehwinkel}

Wie in \fref{sec:lokales_bezugssystem} beschrieben, zeigt die \(z\)-Achse im lokalen Bezugssystem des Ladungstr\"agers genau in die
Richtung des magnetischen Feldes \(\vec{B}\). Um \(\vec{B}\) nun durch Drehungen so zu transformieren, dass die Richtung der
\(z\)-Achse entspricht, k\"onnen Eulersche Winkel eingesetzt werden. Da die Drehung von \(\vec{B}\) auf die \(z\)-Achse genau der
entgegengesetzten, also der \textit{inversen} Drehung der \(z\)-Achse auf \(\vec{B}\) entspricht, die Winkel zu dieser inversen
Drehung allerdings leichter zu bestimmen sind, wird zun\"achst die \(z\)-Achse auf \(\vec{B}\) gedreht. Diese Transformation kann
dann unter Verwendung von \fref{eq:gesamtdrehung} im Umkehrschluss auf \(\vec{B}\) angewandt werden, um die eigentlich relevante
Drehmatrix zu erhalten.

Um die \(z\)-Achse, im Folgenden mit der Bezeichnung des Einheitsvektors \(\vec{z}\) beschrieben, auf \(\vec{B}\) zu drehen, sind
zwei Drehungen erforderlich: Zun\"achst muss eine Drehung um die \(y\)-Achse um den Winkel \(\alpha\), anschlie{\ss}end eine Drehung
um die lokal mitgedrehte \(x\)-Achse um den Winkel \(\beta\) erfolgen.

Der Winkel \(\alpha\) l\"asst sich bestimmen, indem \(\vec{B}\) zun\"achst orthogonal auf die \(xz\)-Ebene projiziert wird. \(\alpha\)
entspricht dann genau dem Winkel zwischen dem aus der Projektion resultierenden Vektor \(\vec{p}_B\) und \(\vec{z}\).
Um \(\vec{B}\) auf die \(xz\)-Ebene zu projizieren, kann einfach \(\vec{B}_y=0\) gesetzt werden. Zur Berechnung des Winkels
zwischen \(\vec{p}_B\) und \(\vec{z}\)
wird folgender Zusammenhang verwendet, der f\"ur den Winkel zwischen zwei beliebigen Vektoren \(\vec{a}\) und \(\vec{b}\) gilt:
\begin{equation}
  \sphericalangle{\left(\vec{a},\vec{b}\right)} = \arccos{\left(\frac{\vec{a} \cdot \vec{b}}{\abs{a} \cdot \abs{b}}\right)}
\end{equation}
wobei \(\abs{\cdot}\) der euklidischen Norm entspricht. Da \(\vec{z}\) Einheitsvektor ist, gilt \(\abs{\vec{z}} = 1\), weiterhin ist
\(\vec{z}_x = \vec{z}_y = 0\), weshalb \(\vec{z} \cdot \vec{p}_B = \vec{p}_{B_z} = \vec{B}_z\). Insgesamt ergibt sich also f\"ur den
Winkel \(\alpha\):
\begin{equation}
  \label{eq:alpha}
  \alpha = \arccos{\left(\frac{\vec{B}_z}{\abs{\vec{p}_B}}\right)}
\end{equation}
Da man durch Anwendung dieser Formel ausschlie{\ss}lich Winkel im Bereich von \(0 \leq \alpha \leq \pi\) erh\"alt, ist noch eine kleine
Anpassung n\"otig, damit auch im Falle eines \"uberstumpfen Winkels korrekt gedreht werden kann. Dieser Fall l\"asst sich erkennen,
indem die \(x\)-Koordinate von \(\vec{p}_B\) \"uberpr\"uft wird. Ist diese positiv, sind keine weiteren Anpassungen notwendig,
ist sie negativ, kann einfach in die andere Richtung, also um den Winkel \(-\alpha\) gedreht werden. F\"ur den Fall, dass \(\vec{p}_B\)
gerade dem Nullvektor entspricht, also dass \(\vec{B}\) genau in Richtung der \(y\)-Achse zeigt, entf\"allt die Notwendigkeit
der Drehung. Hier kann formal \(\alpha = 0\) gesetzt werden.

Um nun den Drehwinkel \(\beta\) zu bestimmen, der die Drehung um die \textit{lokale} mitgedrehte \(x\)-Achse beschreibt, wird
zun\"achst der Winkel \(\delta\) berechnet, welcher den Winkel zwischen der \(y\)-Achse, im Folgenden mit \(\vec{y}\) bezeichnet,
und \(\vec{B}\) angibt. Der Winkel \(\beta\) ergibt sich dann anschaulich aus dem Zusammenhang \(\beta = \delta - \frac{\pi}{2}\).

\subsubsection{Zusammenfassung der Transformationsschritte}

\section{Ausweitung auf inhomogene Magnetfelder}

\subsection{Diskretisierung inhomogener Magnetfelder}

\subsubsection{TODO Fehler}

\section{Abbruchkriterien}

\section{Der resultierende Algorithmus}
